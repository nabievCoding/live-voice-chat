
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Voice Chat</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }
    #mic-indicator {
      margin-top: 20px;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #3b82f6;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      color: white;
      font-size: 32px;
    }
    #mic-wave {
      position: absolute;
      border: 4px solid #93c5fd;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
      opacity: 0.6;
    }
    @keyframes pulse {
      0%   { transform: scale(1); opacity: 0.7; }
      100% { transform: scale(2); opacity: 0; }
    }
    #log {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      width: 80%;
      max-width: 500px;
      min-height: 80px;
      background: #f9fafb;
      font-family: monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>üé§ Live Voice Chat (Agora)</h2>
  <button id="joinBtn">Join Channel</button>

  <div id="mic-indicator" style="display:none;">
    <div id="mic-wave"></div>
    üé§
  </div>

  <p id="log">Logs:\n</p>

      <script src="https://cdn.agora.io/sdk/release/AgoraRTC_N.js"></script>

  <script>
    const APP_ID = "c5423838ad7a449c9e48d90088944c10";  // üëâ bu yerga App ID qo‚Äòyasiz
    const CHANNEL = "testChannel";
    const TOKEN = null; // testing uchun token bo‚Äòlmasa ham ishlaydi

    const client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
    let localTrack;

    // Log chiqaruvchi funksiya
    function log(msg) {
      document.getElementById("log").innerText += msg + "\n";
    }

    document.getElementById("joinBtn").onclick = async () => {
      try {
        log("Joining channel...");
        await client.join(APP_ID, CHANNEL, TOKEN, null);
        log("Joined successfully ‚úÖ");

        localTrack = await AgoraRTC.createMicrophoneAudioTrack();
        await client.publish([localTrack]);
        log("Microphone published üé§");

        // Mic indikatorini ko‚Äòrsatamiz
        document.getElementById("mic-indicator").style.display = "flex";

        // Ovozni o‚Äòlchab, mic wave ni kattalashtiramiz
        setInterval(() => {
          const level = localTrack.getVolumeLevel(); // 0-1 oralig‚Äòida
          const micWave = document.getElementById("mic-wave");
          micWave.style.width = `${80 + level * 100}px`;
          micWave.style.height = `${80 + level * 100}px`;
        }, 200);

        // Boshqa foydalanuvchilarni eshitish
        client.on("user-published", async (user, mediaType) => {
          await client.subscribe(user, mediaType);
          if (mediaType === "audio") {
            user.audioTrack.play();
            log("New user joined and audio playing üîä");
          }
        });

      } catch (err) {
        log("‚ùå Error: " + err.message);
      }
    };
  </script>
</body>
</html>
