<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple Video Chat</title>
</head>
<body>
  <h2>Video Chat</h2>
  <input id="username" placeholder="Ismingiz" />
  <button id="joinBtn">Qo'shilish</button>
  <div id="videoContainer"></div>

  <script src="https://cdn.agora.io/sdk/release/AgoraRTC_N.js"></script>
  <script>
    const APP_ID = "c5423838ad7a449c9e48d90088944c10";
    const CHANNEL = "testChannel";

    const joinBtn = document.getElementById("joinBtn");
    const videoContainer = document.getElementById("videoContainer");

    let client;
    let localAudioTrack, localVideoTrack;

    joinBtn.onclick = async () => {
      const username = document.getElementById("username").value;
      if (!username) return alert("Ismingizni kiriting!");

      client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
      const uid = await client.join(APP_ID, CHANNEL, null, null);

      // Lokal audio va video trek
      localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();
      localVideoTrack = await AgoraRTC.createCameraVideoTrack();

      // Lokal videoni ko'rsatish
      const localPlayer = document.createElement("div");
      localPlayer.id = `local-player-${uid}`;
      localPlayer.style.width = "300px";
      localPlayer.style.height = "200px";
      videoContainer.appendChild(localPlayer);
      localVideoTrack.play(localPlayer);

      await client.publish([localAudioTrack, localVideoTrack]);
      console.log("Audio va Video track published");

      // Boshqa foydalanuvchilarni kuzatish
      client.on("user-published", async (user, mediaType) => {
        await client.subscribe(user, mediaType);

        if (mediaType === "video") {
          const remotePlayer = document.createElement("div");
          remotePlayer.id = `remote-player-${user.uid}`;
          remotePlayer.style.width = "300px";
          remotePlayer.style.height = "200px";
          videoContainer.appendChild(remotePlayer);
          user.videoTrack.play(remotePlayer);
        }

        if (mediaType === "audio") {
          const audioTrack = user.audioTrack;
          const audioElement = document.createElement("audio");
          audioElement.autoplay = true;
          audioElement.srcObject = audioTrack.mediaStream;
          videoContainer.appendChild(audioElement);
        }
      });
    };
  </script>
</body>
</html>

    };
  </script>
</body>
</html>

